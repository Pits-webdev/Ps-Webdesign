---
import Logo from "@assets/svg/ps-logo.svg";
import Button from "./ui/Button.astro";
import Link from "./ui/Link.astro";

const pages = [
   {
      name: "Über mich",
      link: "/ueber-mich",
   },
   {
      name: "Leistungen",
      link: "/leistungen",
   },
   { name: "Arbeit", link: "/arbeiten" },
   { name: "Blog", link: "/blog" },
];

const baseUrl = import.meta.env.BASE_URL;
// href={`${baseUrl}${page.link}`.replace(/\/+/g, '/')}
---

<header
   class="fixed top-0 left-0 w-full h-24 bg-background/10 text-foreground backdrop-blur-[6px] z-50"
>
   <nav
      id="nav"
      class="w-container mx-auto px-4 h-full flex justify-between items-center relative"
   >
      <!-- 1. LOGO -->

      <div class="flex items-center">
         <a
            href={`${import.meta.env.BASE_URL}`}
            class="flex gap-2 items-end text-primary h-fit"
         >
            <Logo height={42} />
            <span class="text-foreground tracking-wide">Webdesign</span>
         </a>
      </div>

      <!-- 2. NAVIGATION LISTE -->
      <!-- 
         Desktop: Tailwind Klassen (hidden lg:flex ...)
         Mobile Open: Wird unten im <style> Block gesteuert
      -->

      <div class="w-full h-full flex items-center justify-center">
         <ul
            id="nav-list"
            data-state="closed"
            class="flex items-center space-x-20 bg-white/15 px-4 py-3 rounded-lg border border-border"
         >
            {
               pages.map(({ name, link }) => (
                  <li>
                     <a
                        href={`${baseUrl}${link}`.replace(/\/+/g, "/")}
                        class="text-base tracking-wider  hover:text-primary transition-colors"
                     >
                        {name}
                     </a>
                  </li>
               ))
            }
         </ul>
      </div>

      <div>
         <!-- "w-fit text-black bg-white rounded-lg border border-background"; -->
         <Button
            variant="light"
            styles="w-fit bg-border rounded-lg border border-border pl-4 pr-1 py-0.5"
         >
            <Link title="Kontakt" path="/" />
         </Button>

         <button
            id="nav-toggle"
            class="hidden p-2 text-foreground hover:text-primary focus:outline-none z-50"
            aria-label="Menü umschalten"
            aria-expanded="false"
         >
            <!-- Hamburger Icon -->
            <svg
               xmlns="http://www.w3.org/2000/svg"
               fill="none"
               viewBox="0 0 24 24"
               stroke-width="1.5"
               stroke="currentColor"
               class="size-6"
            >
               <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
            </svg>
         </button>
      </div>
   </nav>
</header>

<!-- 
   CSS STYLE BLOCK (Scoped)
   Hier definieren wir den "Open"-Zustand mit Standard-CSS.
   Das verhindert Fehler mit @apply und hält das HTML sauber.
-->
<style>
   /* Style nur anwenden, wenn data-state="open" ist */
   #nav-list[data-state="open"] {
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 4rem; /* 16 * 0.25rem (h-16 des Headers) */
      left: 0;
      width: 100%;
      height: calc(100vh - 4rem);

      /* Design analog zu deinen Tailwind Wünschen */
      background-color: #d97706; /* amber-600 */
      color: #fef4b8; /* Dein helles Gelb */

      padding: 1.5rem;
      gap: 0.5rem;
      overflow-y: auto;
      z-index: 40;
   }

   /* Styling der List-Items im mobilen Zustand */
   #nav-list[data-state="open"] li {
      width: 100%;
      border-bottom: 1px solid rgba(255, 255, 255, 0.15); /* Zarter Trennstrich */
      padding-top: 1rem;
      padding-bottom: 1rem;
   }

   /* Styling der Links im mobilen Zustand */
   #nav-list[data-state="open"] a {
      font-size: 1.125rem; /* text-lg */
      display: block;
      width: 100%;
   }

   /* Button im Mobile Menu anpassen */
   #nav-list[data-state="open"] a[href*="contact"] {
      background-color: #fef4b8;
      color: #d97706;
      text-align: center;
      margin-top: 1rem;
   }
</style>

<!-- 
   JAVASCRIPT LOGIK
-->
<script>
   class MobileNavigation {
      // Definition der Variablen für TypeScript/Klarheit
      navElement: HTMLElement | null;
      menuBtn: HTMLElement | null;
      menuList: HTMLElement | null;
      state: string;

      constructor(selector: string) {
         this.navElement = document.querySelector(selector);
         this.menuBtn = this.navElement?.querySelector("#nav-toggle") || null;
         this.menuList = this.navElement?.querySelector("#nav-list") || null;

         // Initialen Status sicher auslesen (Standard: "closed")
         this.state = this.menuList?.getAttribute("data-state") || "closed";

         // Starten nur wenn alles da ist
         if (this.navElement && this.menuBtn && this.menuList) {
            this.init();
            this.initResizeListener();
         }
      }

      init() {
         // Click Listener
         this.menuBtn?.addEventListener("click", () => this.toggle());
      }

      toggle() {
         if (this.state === "open") {
            this.close();
         } else {
            this.open();
         }
      }

      open() {
         this.state = "open";
         this.menuList?.setAttribute("data-state", "open");
         this.menuBtn?.setAttribute("aria-expanded", "true");

         // Optional: Icon ändern oder Klasse am Button für Animation
         console.log("Menü geöffnet");
      }

      close() {
         this.state = "closed";
         this.menuList?.setAttribute("data-state", "closed");
         this.menuBtn?.setAttribute("aria-expanded", "false");

         console.log("Menü geschlossen");
      }

      initResizeListener() {
         window.addEventListener("resize", () => {
            // Wenn Fenster größer als 1024px (lg) und Menü offen ist -> schließen
            if (window.innerWidth >= 1024 && this.state === "open") {
               this.close();
            }
         });
      }
   }

   // Klasse initialisieren
   new MobileNavigation("#nav");
</script>
