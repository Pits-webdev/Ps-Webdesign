---
import AstroIcon from "@assets/svg/brand/astro.svg";
import GsapIcon from "@assets/svg/brand/gsap.svg";
import NextIcon from "@assets/svg/brand/next.svg";
import OpenGlIcon from "@assets/svg/brand/opengl.svg";
import ReactIcon from "@assets/svg/brand/react.svg";
import TailwindIcon from "@assets/svg/brand/tailwind.svg";
import ThreeIcon from "@assets/svg/brand/three.svg";
import TypescriptIcon from "@assets/svg/brand/typescript.svg";
import WebglIcon from "@assets/svg/brand/webgl.svg";

const Icons = [
   GsapIcon,
   AstroIcon,
   ReactIcon,
   NextIcon,
   TailwindIcon,
   TypescriptIcon,
   ThreeIcon,
   OpenGlIcon,
   WebglIcon,
];

const { direction = "toLeft" } = Astro.props;
---

<div
   class="marquee-outer relative max-w-full select-none overflow-clip"
   data-direction={direction}
>
   <!-- Verlauf links -->
   <div
      class="w-[120px] h-full absolute top-0 left-0 bg-gradient-to-r from-background to-transparent z-10 pointer-events-none"
   >
   </div>

   <!-- Verlauf rechts -->
   <div
      class="w-[120px] h-full absolute top-0 right-0 bg-gradient-to-l from-background to-transparent z-10 pointer-events-none"
   >
   </div>

   <div class="marquee-inner flex w-max will-change-transform">
      <div class="marquee-track flex shrink-0 gap-32 pl-32 whitespace-nowrap">
         {
            Icons.map((Icon) => (
               <div class="flex items-center justify-center px-12 py-4 border border-border">
                  <Icon class="icon" />
               </div>
            ))
         }
      </div>

      <div class="marquee-track flex shrink-0 gap-32 pl-32 whitespace-nowrap">
         {
            Icons.map((Icon) => (
               <div class="flex items-center justify-center px-12 py-4 border border-border">
                  <Icon class="icon" />
               </div>
            ))
         }
      </div>
   </div>
</div>

<script>
   import gsap from "gsap";
   import { ScrollTrigger } from "gsap/ScrollTrigger";

   gsap.registerPlugin(ScrollTrigger);

   const marqueeElements = gsap.utils.toArray<HTMLElement>(".marquee-outer");

   marqueeElements.forEach((element) => {
      const tracks = element.querySelectorAll(".marquee-track");
      const direction = element.getAttribute("data-direction");

      let speed = 30;

      // Logik: Läuft es nach links oder nach rechts?
      // toRight: Startet bei -100% und fährt auf 0
      // Standard: Startet bei 0 und fährt auf -100%
      const startX = direction === "toRight" ? -100 : 0;
      const endX = direction === "toRight" ? 0 : -100;

      // Startposition setzen
      gsap.set(tracks, { xPercent: startX });

      // Die Animation erstellen
      const tween = gsap.to(tracks, {
         xPercent: endX,
         duration: speed,
         ease: "none",
         repeat: -1,
         paused: true, // Startet erst mal pausiert
      });

      // ScrollTrigger kümmert sich NUR noch um Play/Pause (Performance)
      ScrollTrigger.create({
         trigger: element,
         start: "top bottom", // Wenn Oberkante des Elements in den Viewport kommt
         end: "bottom top", // Wenn Unterkante des Elements den Viewport verlässt
         onToggle: (self) => {
            if (self.isActive) {
               tween.play();
            } else {
               tween.pause();
            }
         },
      });
   });
</script>
